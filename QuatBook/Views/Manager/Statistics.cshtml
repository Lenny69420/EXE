@{
	ViewData["Title"] = "Statistics";
	Layout = "_LayoutManager";
}

<div id="content-wrapper">
	<div class="container-fluid">
		<!-- Breadcrumbs -->
		<ol class="breadcrumb">
			<li class="breadcrumb-item">
				<a href="/Manager/Shop">Dashboard</a>
			</li>
			<li class="breadcrumb-item active">Statistics</li>
		</ol>

		<!-- Icon Cards -->
		<div class="row">
			<div class="col-xl-3 col-sm-6 mb-3">
				<div class="card text-white bg-primary o-hidden h-100">
					<div class="card-body">
						<div class="card-body-icon">
							<i class="fas fa-fw fa-shopping-cart"></i>
						</div>
						<div class="mr-5">@ViewBag.OrderStatusTotal Total Orders!</div>
					</div>
					<a class="card-footer text-white clearfix small z-1" asp-action="Orders" asp-controller="Manager">
						<span class="float-left">View Details</span>
						<span class="float-right">
							<i class="fas fa-angle-right"></i>
						</span>
					</a>
				</div>
			</div>
			<div class="col-xl-3 col-sm-6 mb-3">
				<div class="card text-white bg-success o-hidden h-100">
					<div class="card-body">
						<div class="card-body-icon">
							<i class="fas fa-fw fa-dollar-sign"></i>
						</div>
						<div class="mr-5">@ViewBag.RevenueTotal.ToString("C") Total Revenue!</div>
					</div>
					<a class="card-footer text-white clearfix small z-1" href="#">
						<span class="float-left">View Details</span>
						<span class="float-right">
							<i class="fas fa-angle-right"></i>
						</span>
					</a>
				</div>
			</div>
		</div>

		<!-- Charts -->
		<div class="row">
			<!-- Order Status Chart -->
			<div class="col-lg-6">
				<div class="card mb-3">
					<div class="card-header">
						<i class="fas fa-chart-bar"></i> Order Status Statistics
					</div>
					<div class="card-body">
						<canvas id="orderStatusChart" height="200"></canvas>
					</div>
					<div class="card-footer small text-muted">Updated at @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")</div>
				</div>
			</div>

			<!-- Revenue Chart -->
			<div class="col-lg-6">
				<div class="card mb-3">
					<div class="card-header">
						<i class="fas fa-chart-line"></i> Revenue Statistics (Last 7 Days)
					</div>
					<div class="card-body">
						<canvas id="revenueChart" height="200"></canvas>
					</div>
					<div class="card-footer small text-muted">Updated at @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")</div>
				</div>
			</div>
		</div>

		<!-- Top 5 Products and Top 5 Users -->
		<div class="row">
			<!-- Top 5 Best-Selling Products -->
			<div class="col-lg-6">
				<div class="card mb-3">
					<div class="card-header">
						<i class="fas fa-chart-pie"></i> Top 5 Best-Selling Products
					</div>
					<div class="card-body">
						<table class="table table-bordered">
							<thead>
								<tr>
									<th>Image</th>
									<th>Product Name</th>
									<th>Total Quantity Sold</th>
									<th>Total Revenue</th>
								</tr>
							</thead>
							<tbody>
								@foreach (var product in ViewBag.TopProducts)
								{
									<tr>
										<td>
											<img src="~/img/product/@product.ProductImage" alt="@product.ProductName" class="img-thumbnail" style="width: 80px; height: 120px; object-fit: cover;">
										</td>
										<td>@product.ProductName</td>
										<td>@product.TotalQuantity</td>
										<td>@product.TotalRevenue.ToString("C")</td>
									</tr>
								}
							</tbody>
						</table>
					</div>
					<div class="card-footer small text-muted">Updated at @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")</div>
				</div>
			</div>

			<!-- Top 5 Users -->
			<div class="col-lg-6">
				<div class="card mb-3">
					<div class="card-header">
						<i class="fas fa-users"></i> Top 5 Users by Spending
					</div>
					<div class="card-body">
						<table class="table table-bordered">
							<thead>
								<tr>
									<th>Username</th>
									<th>Total Orders</th>
									<th>Total Spent</th>
								</tr>
							</thead>
							<tbody>
								@foreach (var user in ViewBag.TopUsers)
								{
									<tr>
										<td>@user.Username</td>
										<td>@user.TotalOrders</td>
										<td>@user.TotalSpent.ToString("C")</td>
									</tr>
								}
							</tbody>
						</table>
					</div>
					<div class="card-footer small text-muted">Updated at @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")</div>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<!-- Chart.js -->
	<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
	<script>
		// Order Status Chart (Bar Chart)
		const orderStatusCtx = document.getElementById('orderStatusChart').getContext('2d');
		new Chart(orderStatusCtx, {
			type: 'bar',
			data: {
				labels: @Html.Raw(Json.Serialize(ViewBag.OrderStatusLabels)),
				datasets: [{
					label: 'Number of Orders',
					data: @Html.Raw(Json.Serialize(ViewBag.OrderStatusData)),
					backgroundColor: [
						'rgba(255, 99, 132, 0.6)',
						'rgba(54, 162, 235, 0.6)',
						'rgba(255, 206, 86, 0.6)',
						'rgba(75, 192, 192, 0.6)'
					],
					borderColor: [
						'rgba(255, 99, 132, 1)',
						'rgba(54, 162, 235, 1)',
						'rgba(255, 206, 86, 1)',
						'rgba(75, 192, 192, 1)'
					],
					borderWidth: 1
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true,
						title: { display: true, text: 'Number of Orders' }
					},
					x: {
						title: { display: true, text: 'Order Status' }
					}
				},
				plugins: { legend: { display: false } }
			}
		});

		// Revenue Chart (Line Chart)
		const revenueCtx = document.getElementById('revenueChart').getContext('2d');
		new Chart(revenueCtx, {
			type: 'line',
			data: {
				labels: @Html.Raw(Json.Serialize(ViewBag.RevenueLabels)),
				datasets: [{
					label: 'Revenue',
					data: @Html.Raw(Json.Serialize(ViewBag.RevenueData)),
					fill: false,
					borderColor: 'rgba(75, 192, 192, 1)',
					tension: 0.1
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true,
						title: { display: true, text: 'Revenue ($)' }
					},
					x: {
						title: { display: true, text: 'Date' }
					}
				}
			}
		});
	</script>
}